---
title: "Calculation of Specific Cut-Points"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Calculation of Specific Cut-Points}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(popmetrics)
```



## Getting ready for using popmetrics

No criterion measure is needed to extract the age- and sex-specific
cut-points as they are based on the population (or study sample)
descriptives and their recorded free-living physical activity.

### Input

The expected input for `popmetrics` to work consists of two main pieces.
First, data frame(s) with epoch-level aggregation of acceleration
values, and second, the descriptive values to be considered when fitting
the cut-points to the population.

Preferably, the acceleration aggregation measure would be calculated
following any of the methodologies proposed in the physical activity
literature. Examples include (but are not limited to) ENMO (2), MAD (3),
MIMS (4), AI0 (5), or activity counts (6).

#### Acceleration values

There are two possibilities, either providing a single data frame
containing the information for all the participants in the study sample,
or providing data frames for each individual.

-   In the first case, the user should provide the data frame as an R
    object of class data.frame or data.table containing three columns:
    ID, time stamp, and acceleration metric.

-   In the second scenario, the user can provide the path to a folder
    containing csv or RData files for each individual. In this case,
    `popmetrics` would derive the ID from the file names by eliminating
    the file extension (e.g., `id001.csv` would result in `id001`).
    Thus, the data frames should only contain two columns with the time
    stamp and the acceleration metric.

The format of the columns is expected to be as follows:

-   **ID column:** it can contain either character or numeric
    specification of the participants' IDs.

-   **Time stamp column:** it should contain the beginning of each epoch
    either as a `POSIX`, `ISO8601`, or a `character` with format
    specified by the user (following the standards explained in the
    documentation of `base::strptime`.

-   **Acceleration values:** it should contain the acceleration metric
    that would be used in the calculation of the cut-points.

#### Descriptive values

A second data frame is expected from the user containing the descriptive
values of the study sample. This data frame should contain a column with
the ID, and as many columns as factors should be used in the calculation
(e.g., ID, sex, age). It is imperative that the ID in this data frame
exactly matches the ID extracted or specified in the acceleration
values.

A specific terminology is used for the specification of the factors in
the `popmetrics` functions:

-   `factor_split` refers to any factor that would be used to split the
    sample before fitting the distribution of the accelerations.
    Usually, this would be a factor with not many levels (e.g., sex or
    weight status).

-   `factor_fit` refers to the factor over which the GAMLSS model would
    estimate the distribution of the acceleration metric. Usually, this
    includes a finer gradient of levels (e.g., age).

## Output

The output of `popmetrics` would be a data frame with the cut-points to
classify moderate-to-vigorous physical activity specifically for the
subgroups of the population that result from the application of the
factors (`factor_split` and `factor_fit`).
